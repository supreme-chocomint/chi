function collectSeasonalVAsCallback(a,b,c){let d=window.currentDisplay.vaTableBody,e=d.getAttribute("data-async-count");cacheSeasonRawData(a,b,c),extractVAs(window.seasonalRolesCounter,window.voiceActors,c),e?(e=parseInt(e),e++,d.setAttribute("data-async-count",e),e==window.mediaFormats.length&&(sortedSeasonalVoiceActorIds=sortVaIdsByNumRoles(window.seasonalRolesCounter,window.voiceActors),fillVATableAndPage(sortedSeasonalVoiceActorIds),d.setAttribute("data-async-count",0),unlock())):d.setAttribute("data-async-count",1)}function cacheSeasonRawData(a,b,c){for(let d=!1;!d;)window.seasonRawData[a]?window.seasonRawData[a][b]?d=!0:window.seasonRawData[a][b]={}:window.seasonRawData[a]={};window.seasonRawData[a][b][window.seasonRawDataIndex]=c,window.seasonRawDataIndex++,window.seasonRawDataIndex==window.mediaFormats.length&&(window.seasonRawDataIndex=0)}function extractVAs(a,b,c){let d=c.data.Page.media;for(let e of getAllShowCharacterDatas(d))for(let c of getVoiceActors(e))c.id in a?a[c.id]+=1:a[c.id]=1,c.id in b||(b[c.id]=c)}function getVoiceActors(a){let b=new Set;for(let c of a.voiceActors)b.add({name:parsedName(c.name),id:c.id,url:c.siteUrl,image:c.image.large,language:c.language});return b}function getAllShowCharacterDatas(a){let b=[];for(let c of a){let a=c.characters.edges;b=b.concat(a)}return b}function sortVaIdsByNumRoles(a){let b=[],c=[];for(let c of Object.keys(a))b.push({id:c,numRoles:a[c]});b.sort(function(c,a){return a.numRoles-c.numRoles});for(let d of b)c.push(d.id);return c}function setNavigationOnClicks(){let a=document.getElementById("left-nav"),b=document.getElementById("right-nav");a.onclick=function(){leftNavOnClick()},b.onclick=function(){rightNavOnClick()}}function leftNavOnClick(){let a=document.getElementById("left-nav"),b=document.getElementById("right-nav"),c=window.currentDisplay.vaTableBody.getAttribute("data-pageIndex"),d=document.getElementById("language-filter"),e=d.options[d.selectedIndex].value,f=window.scrollX,g=window.scrollY,h=window.currentDisplay.vaTable.clientHeight,i=0;c=parseInt(c),c--,switchToPage(c,e),window.currentDisplay.vaTableBody.setAttribute("data-pageIndex",c),0==c&&a.classList.add("inactive"),b.classList.remove("inactive"),i=window.currentDisplay.vaTable.clientHeight-h,window.scroll(f,g+i)}function rightNavOnClick(){let a=document.getElementById("right-nav"),b=document.getElementById("left-nav"),c=window.currentDisplay.vaTableBody,d=document.getElementById("language-filter"),e=d.options[d.selectedIndex].value,f=window.scrollX,g=window.scrollY,h=window.currentDisplay.vaTable.clientHeight,i=0,j=c.getAttribute("data-pageIndex"),k=c.getAttribute("data-pageCount");j=parseInt(j),k=parseInt(k)-1,j++,switchToPage(j,e),window.currentDisplay.vaTableBody.setAttribute("data-pageIndex",j),j==k&&a.classList.add("inactive"),b.classList.remove("inactive"),i=window.currentDisplay.vaTable.clientHeight-h,window.scroll(f,g+i)}function onSeasonChange(){window.clicked&&VAOnClick(window.clicked)}function onLanguageChange(){let a=window.currentDisplay.vaTableBody,b=document.getElementById("language-filter"),c=b.options[b.selectedIndex].value;resetVaTablePages(c),setNavigationState(a,a.getAttribute("data-pageSize"),c)}function populateVATableWithSeason(){let a=document.getElementById("quarter-picker"),b=window.currentDisplay.vaTable,c=a.options[a.selectedIndex].value.toUpperCase(),d=document.getElementById("year-picker").value,e={perPage:50,page:1,season:c,seasonYear:d};if(clearSeasonSpecificData(),b.setAttribute("data-state","season"),window.currentDisplay.setVATableHeader(" VAs for "+parsedSeason(c,d)),window.seasonRawData[d]&&window.seasonRawData[d][c]){for(let a,b=0;b<window.mediaFormats.length;b++)a=window.seasonRawData[d][c][b],extractVAs(window.seasonalRolesCounter,window.voiceActors,a);populateVATableWithSeasonCache(),unlock()}else for(let a of window.mediaFormats)e.format=a,makeRequest(getQuery(""),e,function(a){collectSeasonalVAsCallback(d,c,a)})}function populateVATableWithSeasonCache(){sortedSeasonalVoiceActorIds=sortVaIdsByNumRoles(window.seasonalRolesCounter,window.voiceActors),fillVATableAndPage(sortedSeasonalVoiceActorIds)}function clearSeasonSpecificData(){window.seasonalRolesCounter={}}function fillVATableAndPage(a){let b=window.currentDisplay.vaTableBody,c=window.currentDisplay.tablePageSize;b.style.visibility="hidden";let d=0;for(let c of a){let a=window.voiceActors[c];addVATableEntry(a),updateLanguageFilter(a.language);let e=b.lastChild;e.id=d,d++}styleVATable(),setNavigationState(b,c,"ALL"),switchToPage(0,"ALL"),b.style.visibility=""}function addVATableEntry(a){window.currentDisplay.addVATableEntry(a)}function switchToPage(a,b){let c=window.currentDisplay.vaTableBody,d=document.getElementById("page-tracker"),e=c.getAttribute("data-pageSize"),f=c.getAttribute("data-pageCount");if(c.style.display="none","ALL"!=b){let d=0,f=0;for(let g of c.children){if(g.classList.contains(b)){if(e*a<=d&&d<e*(a+1))try{c.children[f].style.display=""}catch(b){console.log("Pg."+a+", e."+f+" doesn't exist. Probably expected behaviour.")}else g.style.display="none";d++}else g.style.display="none";f++}}else{for(let a of c.children)a.style.display="none";for(let b=e*a;b<e*(a+1);b++)try{c.children[b].style.display=""}catch(a){}}c.style.display="",d.innerHTML=(a+1).toString()+"/"+f.toString()}function styleVATable(a){window.currentDisplay.styleVATable(a)}function setNavigationState(a,b,c){let d;d="ALL"==c?Math.ceil(a.childElementCount/b):Math.ceil(a.querySelectorAll("."+c).length/b),0==d&&d++,a.style.display="",a.setAttribute("data-pageIndex",0),a.setAttribute("data-pageSize",b),a.setAttribute("data-pageCount",d),1==d?document.getElementById("right-nav").classList.add("inactive"):document.getElementById("right-nav").classList.remove("inactive"),document.getElementById("page-tracker").innerHTML="1/"+d.toString()}function setVATableState(a){window.currentDisplay.vaTable.setAttribute("data-state",a)}function clearVATable(){let a=window.currentDisplay.vaTableBody;a.innerHTML="",a.setAttribute("data-pageIndex",0),a.setAttribute("data-pageCount",1),document.getElementById("left-nav").classList.add("inactive"),document.getElementById("right-nav").classList.add("inactive"),document.getElementById("language-filter").innerHTML="",updateLanguageFilter("ALL"),window.currentDisplay.setVATableHeader("")}function resetVaTablePages(a){window.currentDisplay.vaTable.setAttribute("data-pageIndex",0),document.getElementById("left-nav").classList.add("inactive"),document.getElementById("right-nav").classList.remove("inactive"),switchToPage(0,a)}function buildSeasonPickers(){buildYearPicker(),buildQuarterPicker()}function buildYearPicker(){let a=document.getElementById("year-picker");for(let b,c=1950;2020>=c;c++)b=document.createElement("option"),b.value=c,b.innerHTML=c,a.appendChild(b);a.onchange=function(){onSeasonChange()}}function buildQuarterPicker(){let a=document.getElementById("quarter-picker"),b=["WINTER","SPRING","SUMMER","FALL"];for(let c of b){let b=document.createElement("option");b.value=c,b.innerHTML=c,a.appendChild(b)}a.onchange=function(){onSeasonChange()}}function setSeason(a,b){if(!a||!b){let c=Math.floor(new Date().getMonth()/3);a=new Date().getFullYear(),b={0:"WINTER",1:"SPRING",2:"SUMMER",3:"FALL"}[c]}document.getElementById("year-picker").value=a,document.getElementById("quarter-picker").value=b}function buildLanguageFilter(){updateLanguageFilter("ALL"),document.getElementById("language-filter").onchange=function(){onLanguageChange()}}function updateLanguageFilter(a){let b=document.getElementById("language-filter");for(let c of b.children)if(c.value==a)return;let c=document.createElement("option");c.value=a,c.innerHTML=a,b.appendChild(c)}