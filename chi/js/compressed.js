function collectSeasonalVAsCallback(a){let b=document.getElementById("va-table-body"),c=b.getAttribute("data-async-count");extractVAs(window.seasonalVoiceActors,window.vaNames,a),c?(c=parseInt(c),c++,b.setAttribute("data-async-count",c),c==window.mediaFormats.length&&(sortedVoiceActors=sortVAsByNumRoles(window.seasonalVoiceActors),fillVATableAndPage(sortedVoiceActors),b.setAttribute("data-async-count",0),unlock())):b.setAttribute("data-async-count",1)}function collectVASearchResultsCallback(a){let b=parseVASearchResults(a),c=b[0],d=b[1];fillVATableAndPage(c),updateVANames(d),unlock()}function updateVANames(a){for(let b of Object.keys(a))b in window.vaNames||(window.vaNames[b]=a[b])}function collectSeasonalRolesCallback(a,b){collectSeasonalRoles(a,b);let c=document.getElementById("roles-table-body"),d=c.getAttribute("data-async-count");d?(d=parseInt(d),c.setAttribute("data-async-count",d+1),d+1==window.mediaFormats.length&&(c.setAttribute("data-async-count",0),""==c.innerHTML&&addNoResultsIndicator("roles-table-body"),unlock())):c.setAttribute("data-async-count",1)}function collectFollowingCallback(a,b){let c=b.data.Staff,d={id:c.id,name:parsedName(c.name),url:c.siteUrl};addFollowTableEntry(d);let e=document.getElementById("follow-table-body").children.length;e==a&&unlock()}function requestVAsInOrder(a){if(0<a.numIterations){let b={id:a.VAs[0][0]},c={numIterations:a.numIterations-1,VAs:a.VAs.slice(1)};makeRequest(getQuery("VA ID"),b,c,addVATableEntryInOrder)}}function addVATableEntryInOrder(a,b){let c=b.data.Staff,d={name:parsedName(c.name),image:c.image.medium,url:c.siteUrl};addVATableEntry(d),requestVAsInOrder(a)}function setLongFormText(){let a=document.getElementById("description-text");a.innerHTML=getDescriptionString()}function hideElements(){document.getElementById("follow-table").style.display="none",document.getElementById("transfer").style.display="none"}function buildSeasonPickers(){buildYearPicker(),buildQuarterPicker()}function buildYearPicker(){let a=document.getElementById("year-picker");for(let b,c=1950;2020>=c;c++)b=document.createElement("option"),b.value=c,b.innerHTML=c,a.appendChild(b);a.onchange=function(){onSeasonChange()}}function buildQuarterPicker(){let a=document.getElementById("quarter-picker"),b=["WINTER","SPRING","SUMMER","FALL"];for(let c of b){let b=document.createElement("option");b.value=c,b.innerHTML=c,a.appendChild(b)}a.onchange=function(){onSeasonChange()}}function clearInputBoxes(){document.getElementById("search-bar").value="",document.getElementById("transfer-box").value=""}function setSeason(a,b){if(!a||!b){let c=Math.floor(new Date().getMonth()/3);a=new Date().getFullYear(),b={0:"WINTER",1:"SPRING",2:"SUMMER",3:"FALL"}[c]}document.getElementById("year-picker").value=a,document.getElementById("quarter-picker").value=b}function switchToPage(a){let b=document.getElementById("va-table-body"),c=document.getElementById("page-tracker"),d=b.getAttribute("data-pageSize"),e=b.getAttribute("data-pageCount");b.style.display="none";for(let c of b.children)c.style.display="none";for(let c=d*a;c<d*(a+1);c++)try{b.children[c].style.display=""}catch(d){appendEmptyRow(b),console.log("Pg."+a+", e."+c+" doesn't exist. Probably expected behaviour.")}b.style.display="",c.innerHTML=(a+1).toString()+"/"+e.toString()}function appendEmptyRow(a){let b=document.createElement("tr"),c=0;switch(a.id){case"va-table-body":c=document.getElementById("va-table-head").getElementsByTagName("th").length,appendNACells(b,c-1);let d=document.createElement("td");d.innerHTML="&nbsp;",b.append(d);break;case"roles-table-body":c=document.getElementById("roles-table-head").getElementsByTagName("th").length,appendNACells(b,c-1);break;default:c=2,appendNACells(b,c-1);}a.appendChild(b)}function fillVATableAndPage(a){let b=document.getElementById("va-table-body"),c=5;b.style.visibility="none";let d=0;for(let c of a){let a={id:c[0],name:c[1],numRoles:c[2],url:c[3]};addVATableEntry(a);let e=b.lastChild;e.id=d++}for(let e=c;e<d;e++)b.children[e].style.display="none";setVATableSize(a),setNavigationState(b,c)}function setVATableSize(a){0==a.length?(document.getElementById("va-table-header-roles").style.display="none",document.getElementById("va-table-header-follow").style.display="none",addNoResultsIndicator("va-table-body")):null==a[0][2]?(document.getElementById("va-table-header-roles").style.display="none",document.getElementById("va-table-header-follow").style.display=""):(document.getElementById("va-table-header-roles").style.display="",document.getElementById("va-table-header-follow").style.display="")}function setNavigationState(a,b){let c=Math.ceil(a.childElementCount/b);0==c&&c++,a.style.display="",a.setAttribute("data-pageIndex",0),a.setAttribute("data-pageSize",b),a.setAttribute("data-pageCount",c),1==c?document.getElementById("right-nav").classList.add("inactive"):document.getElementById("right-nav").classList.remove("inactive"),document.getElementById("page-tracker").innerHTML="1/"+c.toString()}function addRolesTableEntry(a){let b=document.createElement("tr"),c=document.createElement("td"),d=document.createElement("a"),e=document.createElement("td"),f=document.createElement("a");d.innerHTML=a.showName,d.href=a.showUrl,d.target="_blank",f.innerHTML=a.characterName,f.href=a.characterUrl,f.target="_blank",c.appendChild(d),e.appendChild(f),b.appendChild(c),b.appendChild(e),document.getElementById("roles-table-body").appendChild(b)}function addNoResultsIndicator(a){let b=document.createElement("tr");appendNACells(b,2),document.getElementById(a).appendChild(b)}function appendNACells(a,b){for(let c,d=0;d<b;d++)c=document.createElement("td"),c.innerHTML="N/A",a.appendChild(c)}function addVATableEntry(a){let b=document.createElement("tr"),c=document.createElement("td"),d=document.createElement("a"),e=document.createElement("td"),f=document.createElement("a"),g=document.createElement("td"),h=document.createElement("span"),i=document.createElement("td"),j=document.createElement("a");d.innerHTML=a.name,d.href="javascript:void(0)",d.classList.add("internal_link"),d.onclick=function(){VAOnClick(a.id)},c.appendChild(d),b.appendChild(c),f.innerHTML="See on AniList",f.href=a.url,f.target="_blank",e.appendChild(f),b.appendChild(e),a.numRoles&&(h.innerHTML=a.numRoles,g.appendChild(h),b.appendChild(g)),j.innerHTML=isFollowed(a.id)?"\u2605":"\u2606",j.href="javascript:void(0)",j.classList.add("symbol"),i.classList.add("symbol"),j.onclick=function(){j.innerHTML=toggleFollow(a)},d.classList.add(a.id),window.clicked==a.id&&d.classList.add("clicked"),i.appendChild(j),b.appendChild(i),document.getElementById("va-table-body").appendChild(b)}function clearVATable(){let a=document.getElementById("va-table-body");a.innerHTML="",a.setAttribute("data-pageIndex",0),a.setAttribute("data-pageCount",1),document.getElementById("left-nav").classList.add("inactive"),document.getElementById("right-nav").classList.add("inactive"),document.getElementById("va-table-caption").setAttribute("data-content","")}function clearRolesTable(){let a=document.getElementById("roles-table-body");a.innerHTML="",a.setAttribute("data-async-count",0)}function setNavigationOnClicks(){let a=document.getElementById("left-nav"),b=document.getElementById("right-nav");a.onclick=function(){leftNavOnClick()},b.onclick=function(){rightNavOnClick()}}function searchButtonOnClick(){let a=document.getElementById("search-bar").value;if(!isLocked()&&""!=a){lock(),clearVATable();let b=document.getElementById("va-table-caption");b.setAttribute("data-content"," search '"+a+"'"),makeRequest(getQuery("VA SEARCH"),{perPage:30,page:1,search:a},collectVASearchResultsCallback)}}function onSeasonChange(){window.clicked&&VAOnClick(window.clicked)}function VAOnClick(a){let b=document.getElementById("va-table-body"),c=document.getElementById("quarter-picker"),d=c.options[c.selectedIndex].value.toUpperCase(),e=document.getElementById("year-picker").value,f={perPage:50,page:1,season:d,seasonYear:e};if(!isLocked()){lock(),clearRolesTable(),unclick(),click(a);for(let b of window.mediaFormats)f.format=b,makeRequest(getQuery(""),f,function(b){collectSeasonalRolesCallback(a,b)})}}function refreshButtonOnClick(){isLocked()||(lock(),document.getElementById("search-bar").value="",clearVATable(),clearRolesTable(),unclick(),populateVATableWithSeason())}function darkModeSwitchOnClick(){let a=document.getElementsByTagName("body")[0],b=document.getElementById("dark-mode-switch");a.classList.contains("dark")?(a.classList.remove("dark"),b.value="Turn Dark Mode On",saveTheme("light")):(a.classList.add("dark"),b.value="Turn Dark Mode Off",saveTheme("dark"))}function leftTableSwitchOnClick(){let a=document.getElementById("va-table"),b=document.getElementById("follow-table"),c=document.getElementById("follow-table-body"),d=document.getElementById("search-bar"),e=document.getElementById("search-button"),f=document.getElementById("refresh-button"),g=document.getElementById("navigation"),h=document.getElementById("transfer");"none"==a.style.display?(changed=c.getAttribute("data-changed"),"true"==changed&&(clearVATable(),populateVATableWithSeason(),c.setAttribute("data-changed","false")),a.style.display="",b.style.display="none",d.disabled=!1,e.disabled=!1,f.classList.remove("disabled"),g.style.display="",h.style.display="none"):(a.style.display="none",b.style.display="",d.disabled=!0,e.disabled=!0,f.classList.add("disabled"),g.style.display="none",h.style.display="")}function leftNavOnClick(){let a=document.getElementById("left-nav"),b=document.getElementById("right-nav"),c=document.getElementById("va-table-body").getAttribute("data-pageIndex");c=parseInt(c),c--,switchToPage(c),document.getElementById("va-table-body").setAttribute("data-pageIndex",c),0==c&&a.classList.add("inactive"),b.classList.remove("inactive")}function rightNavOnClick(){let a=document.getElementById("right-nav"),b=document.getElementById("left-nav"),c=document.getElementById("va-table-body"),d=c.getAttribute("data-pageIndex"),e=c.getAttribute("data-pageCount");d=parseInt(d),e=parseInt(e)-1,d++,switchToPage(d),document.getElementById("va-table-body").setAttribute("data-pageIndex",d),d==e&&a.classList.add("inactive"),b.classList.remove("inactive")}function importButtonOnClick(){let a=document.getElementById("transfer-box").value,b=document.getElementById("follow-table-body"),c=window.confirm("Importing will replace all existing follows. Are you sure?");c&&(isJson(a)?(localStorage.setItem("following",a),b.innerHTML="",populateFollowTable(),b.setAttribute("data-changed",!0)):window.alert("Import data invalid. No changes made to existing follows."))}function exportButtonOnClick(){let a=document.getElementById("transfer-box");a.value=JSON.stringify(getFollowing())}function unclick(){let a=document.getElementById("roles-table-caption");a.setAttribute("data-content",""),window.clicked=""}function click(a){let b=window.vaNames[a],c=document.getElementById("roles-table-caption"),d=document.getElementById("quarter-picker").value,e=document.getElementById("year-picker").value;c.setAttribute("data-content"," "+b+" for "+parsedSeason(d,e)),window.clicked=a}function isFollowed(a){try{let b=getFollowing();if(b)return!!b[a];if({}==b)return!1}catch(a){return!1}}function getFollowing(){let a=JSON.parse(localStorage.getItem("following"));return a?a:{}}function setStorageState(){try{return localStorage.getItem("following"),console.log("Katta na! GAHAHA"),!0}catch(a){return warningString="Cookies and site data permissions must be enabled for some site features to work. This includes the ability to follow voice actors.",setTimeout(function(){window.alert(warningString)},1),disableFollowing(),!1}}function disableFollowing(){let a=document.getElementById("va-table");a.style.display="",document.getElementById("follow-table").style.display="none",document.getElementById("left-table-switch").disabled=!0}function toggleFollow(a){return following=getFollowing(),{}==following?(follow(a),"\u2605"):a.id in following?(unfollow(a),"\u2606"):(follow(a),"\u2605")}function follow(a){let b=getFollowing();b[a.id]=!0,localStorage.setItem("following",JSON.stringify(b)),addFollowTableEntry(a)}function unfollow(a){allFollowing=getFollowing(),delete allFollowing[a.id],localStorage.setItem("following",JSON.stringify(allFollowing)),removeFollowTableEntry(a.id)}function addFollowTableEntry(a){let b=document.getElementById("follow-table-body"),c=document.createElement("tr"),d=document.createElement("td"),e=document.createElement("a"),f=document.createElement("td"),g=document.createElement("a"),h=document.createElement("td"),i=document.createElement("a");c.id=a.id,e.classList.add(a.id),window.clicked==a.id&&e.classList.add("clicked"),e.innerHTML=a.name,e.href="javascript:void(0)",e.classList.add("internal_link"),e.onclick=function(){VAOnClick(a.id)},g.innerHTML="See on AniList",g.href=a.url,g.target="_blank",i.innerHTML="&times;",i.href="javascript:void(0)",h.classList.add("symbol"),i.classList.add("symbol"),i.onclick=function(){unfollow(a)},d.appendChild(e),f.appendChild(g),h.appendChild(i),c.appendChild(d),c.appendChild(f),c.appendChild(h),b.appendChild(c)}function removeFollowTableEntry(a){let b=document.getElementById("follow-table-body");for(let c of b.children)if(c.id==a){b.removeChild(c),b.setAttribute("data-changed",!0);break}}window.onload=function(){let a=document.getElementsByTagName("body")[0],b="light",c=setStorageState();if(c){let c=setThemeFromStorage();c||a.classList.add(b)}else a.classList.add(b);setOnClicks(),setOnKeyPresses(),setLongFormText(),hideElements(),buildSeasonPickers(),clearInputBoxes(),clearVATable(),setSeason("",""),window.mediaFormats=["TV","ONA","TV_SHORT"],window.vaNames={},populateVATableWithSeason(),c&&populateFollowTable()};function setOnClicks(){let a=document.getElementById("search-button"),b=document.getElementById("refresh-button"),c=document.getElementById("dark-mode-switch"),d=document.getElementById("left-table-switch"),e=document.getElementById("import-button"),f=document.getElementById("export-button");a.onclick=function(){searchButtonOnClick()},b.onclick=function(){refreshButtonOnClick()},c.onclick=function(){darkModeSwitchOnClick()},d.onclick=function(){leftTableSwitchOnClick()},e.onclick=function(){importButtonOnClick()},f.onclick=function(){exportButtonOnClick()},setNavigationOnClicks()}function setOnKeyPresses(){let a=document.getElementById("search-bar");a.addEventListener("keyup",function(a){a.keyCode==13&&searchButtonOnClick()})}function populateVATableWithSeason(){let a=document.getElementById("quarter-picker"),b=document.getElementById("va-table-caption"),c=a.options[a.selectedIndex].value.toUpperCase(),d=document.getElementById("year-picker").value,e={perPage:50,page:1,season:c,seasonYear:d};lock(),window.seasonalVoiceActors={},b.setAttribute("data-content"," VAs for "+parsedSeason(c,d));for(let a of window.mediaFormats)e.format=a,makeRequest(getQuery(""),e,collectSeasonalVAsCallback)}function populateFollowTable(){let a=getFollowing(),b=Object.keys(a);lock();for(let a of b){makeRequest(getQuery("VA ID"),{id:a},function(a){collectFollowingCallback(b.length,a)})}}function isLocked(){return document.getElementsByTagName("body")[0].classList.contains("locked")}function lock(){document.getElementsByTagName("body")[0].classList.add("locked"),document.getElementById("lock-icon").innerHTML="\uD83D\uDD12"}function unlock(){document.getElementsByTagName("body")[0].classList.remove("locked"),document.getElementById("lock-icon").innerHTML=""}function fetchTheme(){let a=localStorage.getItem("theme");return a}function saveTheme(a){localStorage.setItem("theme",a)}function setThemeFromStorage(){let a=document.getElementsByTagName("body")[0],b=fetchTheme(),c=!1;switch(b&&(a.classList.add(b),c=!0),b){case"light":document.getElementById("dark-mode-switch").value="Turn Dark Mode On";break;case"dark":document.getElementById("dark-mode-switch").value="Turn Dark Mode Off";break;default:}return c}function parsedName(a){let b=a.first,c=a.last;null==a.first&&(b=""),null==a.last&&(c="");let d=b+" "+c;return d.trim()}function parsedSeason(a,b){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()+" "+b}function hasVoiceActor(a,b){for(let c of getVoiceActors(a))if(c.id==b)return!0;return!1}function getVoiceActors(a){let b=new Set;for(let c of a.voiceActors)b.add({name:parsedName(c.name),id:c.id,url:c.siteUrl});return b}function getAllShowCharacterDatas(a){let b=[];for(let c of a){let a=c.characters.edges;b=b.concat(a)}return b}function parseVASearchResults(a){let b=a.data.Page.staff,c=[],d={};for(let e of b){let a=e.id,b=parsedName(e.name),f=e.siteUrl;c.push([a,b,null,f]),d[a]=b}return[c,d]}function collectSeasonalRoles(a,b){let c=b.data.Page.media;for(let d of c){let b=d.characters.edges;for(let c of b)if(hasVoiceActor(c,a)){let a={showID:d.id,showName:d.title.romaji,showImage:d.coverImage,showUrl:d.siteUrl,characterID:c.node.id,characterName:parsedName(c.node.name),characterImage:c.node.image,characterUrl:c.node.siteUrl};addRolesTableEntry(a)}}}function extractVAs(a,b,c){let d=c.data.Page.media;for(let e of getAllShowCharacterDatas(d))for(let c of getVoiceActors(e))c.id in a?a[c.id].numRoles+=1:a[c.id]={numRoles:1,name:c.name,url:c.url},c.id in b||(b[c.id]=c.name)}function sortVAsByNumRoles(a){let b=[];for(let c in a)b.push([c,a[c].name,a[c].numRoles,a[c].url]);return b.sort(function(c,a){return a[2]-c[2]}),b}function isJson(a){a="string"==typeof a?a:JSON.stringify(a);try{a=JSON.parse(a)}catch(a){return!1}return!("object"!=typeof a||null===a)}function getDescriptionString(){return string="Find out what your favorite voice actors are up to this season (or any season) !<br> Browse a season by number of roles, or search by name, and click on the one you want to see from the left-hand / top table.<br> The right-hand / bottom table will generate all TV shows, TV shorts, and ONAs they're involved in.<br>Follow a voice actor by clicking the star icon, and view all follows by clicking the 'toggle following' button.<br><br>Things not loading? Double-check that <a href='https://anilist.co/' target = '_blank'>AniList</a> (the data provider) is online.",string}function getQuery(a){return"VA SEARCH"===a?"\n  query ($page: Int, $perPage: Int, $search:String) {\n\n    Page (page: $page, perPage: $perPage) {\n\n      pageInfo {\n        total\n        currentPage\n        lastPage\n        hasNextPage\n        perPage\n      }\n\n      staff (search: $search) {\n        id\n        name {\n          first\n          last\n        }\n        siteUrl\n      }\n    }\n\n  }\n  ":"VA ID"===a?`
  query ($id: Int) {
    Staff (id: $id) {
      id
      name {
        first
        last
        native
      }
      language
      siteUrl
      image {
        medium
      }
    }
  }
  `:`
  query ($season: MediaSeason!, $seasonYear: Int!, $page: Int, $perPage: Int, $format: MediaFormat!) {
    Page(page: $page, perPage: $perPage) {
      pageInfo {
        total
        currentPage
        lastPage
        hasNextPage
        perPage
      }
      media(season: $season, seasonYear: $seasonYear, format: $format, type: ANIME, sort: POPULARITY_DESC) {
        id
        title {
          romaji
        }
        coverImage {
          medium
        }
        siteUrl
        characters {
          edges {
            id
            role
            voiceActors {
              id
              name {
                first
                last
                native
              }
              language
              siteUrl
              image {
                medium
              }
            }
            node {
              id
              name {
                first
                last
                native
              }
              image {
                medium
              }
              siteUrl
            }
          }
        }
      }
    }
  }
  `}function makeRequest(a,b,c){let d={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:a,variables:b})};fetch("https://graphql.anilist.co",d).then(handleResponse).then(function(a){c(a)}).catch(handleError)}function handleResponse(a){return a.json().then(function(b){return a.ok?b:Promise.reject(b)})}function handleError(a){alert("Error, check console"),console.error(a)}